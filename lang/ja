LANG=ja
LANGUAGE=japanese
LOCALES=ja_JP.UTF-8
TIMEZONE=Asia/Tokyo
KEYBOARD_MODEL=jp106
KEYBOARD_LAYOUTS=jp

lb config \
   --mirror-binary "http://ftp.jp.debian.org/debian/" \
   --bootappend-live \
    "boot=live config quiet splash \
    live-config.locales=$LOCALES \
    live-config.timezone=$TIMEZONE live-config.utc=no \
    live-config.keyboard-model=$KEYBOARD_MODEL \
    live-config.keyboard-layouts=$KEYBOARD_LAYOUTS"

# package-lists
echo "task-$LANGUAGE task-$LANGUAGE-desktop fonts-takao emacs-mozc" > config/package-lists/lang.$LANG.list.chroot

echo "texlive-lang-cjk xdvik-ja yatex" > config/package-lists/lang.$LANG.tex.list.chroot

# kseg
echo "sed -i -e 's/kseg_en/kseg_$LANG/g' /etc/skel/.kseg" > config/hooks/lang.kseg.chroot

# for emacs
cat > config/hooks/lang.emacs.chroot <<EOF
#!/bin/sh
cat > /etc/emacs/site-start.d/99lang.ja.el << EOD
;; for emacs-mozc
(require 'mozc)
(set-language-environment "Japanese")
(setq default-input-method "japanese-mozc")

(setq its-hira-comma "，")
(setq its-hira-period "．")
(eval-after-load "its"
  '(define-its-state-machine-append its-hira-map
     (its-defrule "dhi" "でぃ")
     (its-defrule "dhu" "でゅ")
     (its-defrule "thi" "てぃ")
     (its-defrule "thu" "てゅ")
     (its-defrule "whi" "うぃ")
     (its-defrule "whe" "うぇ")
     (its-defrule "who" "うぉ")))
(toggle-input-method nil)
(setq its-enable-fullwidth-alphabet nil)
EOD
EOF
